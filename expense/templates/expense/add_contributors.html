{% extends "core/base.html" %}

{% block content %}

<div class="col-sm-3 col-lg-3">
  <a href="{% url 'expense:add_teammembers' %}" class="btn btn-info btn-lg btn-block">Add Contributors</a>
  <div class="questions-call">
    Have a question? Need help? Give us a call: 1-800-FAMBRIDGE
  </div>
</div>

<div class="col-sm-9 col-lg-9">
  <div class="add-contributors grey-area">
    <h3>Add Care Contributors</h3>
    <p>
    Let's get the rest of your care team onboard.  To add contributors, share Family Bridge with fellow Care Contributors and we'll send them an email inviting them to join your Family Bridge.
    </p>
    <p>
      To:
    </p>
    <form class="form-inline" role="form" method="POST" action="{% url 'expense:add_teammembers' %}">
      {% csrf_token %}
      {{ teammember_formset.management_form }}
      <div id="teammember-edit-list">
        {% for invite_form in teammember_formset %}
          <div class="row">
            {{ invite_form.id }}
            <div class="form-group col-sm-3 col-lg-3">
              {{ invite_form.first_name }}
            </div>
            <div class="form-group col-sm-3 col-lg-3">
              {{ invite_form.last_name }}
            </div>           
            <div class="form-group col-sm-3 col-lg-3">
              {{ invite_form.email }}
            </div>           
            {% if not forloop.first %}
            <div class="form-group col-sm-3 col-lg-3">
              {% if teammember_formset.can_delete %}
                <i class="icon-remove icon-2x"></i>
              {% endif %}
            </div>
            {% endif %}
          </div>
        {% endfor %}
      </div>

      <div class="row">
        <div class="form-group col-sm-12 col-lg-12">
          <button id="add-teammember" class="btn btn-default"><i class="glyphicon glyphicon-plus"></i>Add Contributor</button>
        </div>
      </div>

      <div class="pull-right">
        <input type="reset" class="btn btn-default" value="Cancel">
        <input type="submit" class="btn btn-success" value="Send">
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block additional_scripts %}
<script type="text/javascript">
    // for handling additional contributors, allow adding contributor up to number
    // of members in the group
    $("#add-teammember").click(function () {
      var total_forms = parseInt($("#id_form-TOTAL_FORMS").attr('value'));
      $("#id_form-TOTAL_FORMS").attr('value', total_forms+1);
      // add new forms
      $.get("{% url 'expense:add_teammember_mixin' %}", {new_form_id: total_forms}, function (data) {
        if (data["result"] == 1) {
          $("#teammember-edit-list").append(data['teammember_form']);
        } else {
          return false;
        }
      });
      return false;
    });
  </script>
{% endblock %}